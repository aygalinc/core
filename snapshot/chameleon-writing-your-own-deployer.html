
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2014-02-09
 Rendered using Maven Reflow Skin 1.0.0 (http://andriusvelykis.github.com/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Writing your own deployer | OW2 Chameleon - Core</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="./css/bootstrap.min.css" rel="stylesheet" />
		<link href="./css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/docs.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />
		
		<link href="http://yandex.st/highlightjs/7.3/styles/github.min.css" rel="stylesheet" />
		
		<link href="./css/lightbox.css" rel="stylesheet" />
		
		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />
		
		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		
<link rel="stylesheet" href="css/font-awesome.css"/>
<link rel="stylesheet" type="text/css" media="screen" href="css/orange.css"/>
<link rel="stylesheet" type="text/css" media="screen" href="css/style.css"/>
	</head>

	<body class="page-chameleon-writing-your-own-deployer project-chameleon-core" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top navbar-inverse">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="index.html"><span class="color-highlight">OW2 Chameleon</span> ~ Core</a>
					<div class="nav-collapse">
						<ul class="nav pull-right">
							<li><a href="downloads.html" title="Download">Download </a></li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="chameleon-quickstart.html" title="Quickstart">Quickstart </a></li>
									<li><a href="chameleon-structure.html" title="Structure">Structure </a></li>
									<li><a href="chameleon-configuration.html" title="Configuration">Configuration </a></li>
									<li><a href="chameleon-directory-monitor.html" title="Deployment">Deployment </a></li>
									<li><a href="chameleon-vm-args.html" title="JVM Arguments">JVM Arguments </a></li>
									<li class="active"><a href="" title="Extend Deployment">Extend Deployment </a></li>
									<li><a href="chameleon-package.html" title="Package your Chameleon">Package your Chameleon </a></li>
									<li><a href="chameleon-service.html" title="Run as service">Run as service </a></li>
									<li><a href="apidocs/index.html" title="API">API </a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Contribute <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="contribution.html" title="Contribute">Contribute </a></li>
									<li><a href="source-repository.html" title="Sources">Sources </a></li>
									<li><a href="http://github.com/ow2-chameleon/core/issues/" title="Issues" class="externalLink">Issues </a></li>
									<li><a href="http://github.com/ow2-chameleon/core" title="Fork on GitHub" class="externalLink">Fork on GitHub </a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>
		
	<div class="container">
	
	<!-- Masthead
	================================================== -->
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="page-header">
 <h1 id="writing_your_own_deployer">Writing your own deployer</h1>
</div> 
<p>by default, Chameleon deploys bundles and configuration from the runtime and application directories. However, your can extend this set with your own type of file.</p> 
<h1 id="mechanism">Mechanism</h1> 
<p>Deployers are published within as OSGi services. They will be invoked by Chameleon when:</p> 
<ul> 
 <li>the framework starts(or when they are initialized)</li> 
 <li>when a new file is created</li> 
 <li>when a file is modified</li> 
 <li>when a file is deleted</li> 
 <li>when the framework stops</li> 
</ul> 
<p>Here is the Deployer interface:</p> 
<pre><code>public interface Deployer {

    /**
    * Does the current deployer accept the given file.
    * The accept method must not check file existence,
    * as it may disable notification on file deletion.
    * @param file the file
    * @return {@literal true} if the file is accepted by
    * the current deployer,
    * {@literal false} otherwise
    */
    boolean accept(File file);

    /**
    * Callback called when an accepted file is created.
    * @param file the new file
    */
    void onFileCreate(File file);

    /**
    * Callback called when an accepted file is updated.
    * @param file the updated file
    */
    void onFileChange(File file);

    /**
    * Callback called when an accepted file is deleted.
    * @param file the file
    */
    void onFileDelete(File file);

    /**
    * Method called when the deployer is initialized.
    * This method is called once per monitored directory,
    * with a potentially empty set of files (if there are
    * no file or if the directory does not contain any
    * accepted files)
    * @param files the set of accepted file currently present
    * is a monitored directory.
    */
    void open(Collection&lt;File&gt; files);

    /**
    * Callback called when the deployer is closed.
    */
    void close();

    }
</code></pre> 
<h1 id="the_accept_method">The accept method</h1> 
<p>Deployers have an <code>accept(File file)</code> method telling to Chameleon if the file is handled or not by the deployer. Obviously you can write your own accept method, but never forget to avoid checking the file existence. Indeed, your deployer would not be notified of file deletion (as the file is already deleted).</p> 
<p>To help you, Chameleon provides two implementation of deployer you can extend:</p> 
<ul> 
 <li><code>org.ow2.chameleon.core.services.DirectoryBasedDeployer</code> - accept all files included in a specified directory (and any sub-directories)</li> 
 <li><code>org.ow2.chameleon.core.services.ExtensionBasedDeployer</code> - accept all files having the specified extension (or set of extensions)</li> 
</ul> 
<h1 id="writing_your_own_deployer1">Writing your own deployer</h1> 
<p>Here is an example of a deployer managing <code>txt</code> files. The <code>DefaultDeployer</code> manages the extensions, and if not overriden, call <code>onFileCreate</code> on each files given to the <code>open</code> method.</p> 
<pre><code>package org.ow2.chameleon.core.activators;

import org.apache.felix.ipojo.annotations.Component;
import org.apache.felix.ipojo.annotations.Provides;
import org.ow2.chameleon.core.services.ExtensionBasedDeployer;

import java.io.File;
import java.util.Collection;

/**
 * A dummy deployer.
 */
@Component
@Instantiate
@Provides
public class TextDeployer extends ExtensionBasedDeployer {

    public TextDeployer() {
        super(&quot;txt&quot;);
    }

    @Override
    public void onFileCreate(File file) {
        System.out.println(&quot;New file &quot; + file.getAbsolutePath());
    }

    @Override
    public void onFileChange(File file) {
        System.out.println(&quot;File content changed :&quot; + file.getAbsolutePath());
    }

    @Override
    public void onFileDelete(File file) {
        System.out.println(&quot;File &quot; + file.getAbsolutePath() + &quot; deleted&quot;);
    }

    @Override
    public void open(Collection&lt;File&gt; files) {
        System.out.println(files.size() + &quot; text files found&quot;);
    }

    @Override
    public void close() {
        System.out.println(&quot;Bye bye&quot;);
    }
}
</code></pre> 
<p>Notice that this deployer is an iPOJO component but it is not necessary.</p>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li><a href="#writing_your_own_deployer" title="Writing your own deployer">Writing your own deployer</a>
		<li><a href="#mechanism" title="Mechanism">Mechanism</a>
		<li><a href="#the_accept_method" title="The accept method">The accept method</a>
		<li><a href="#writing_your_own_deployer1" title="Writing your own deployer">Writing your own deployer</a>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->
	
	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li>
							<a href="./" title="Home">Home </a>
						</li>
						<li>
							<a href="http://github.com/ow2-chameleon/core" title="GitHub project" class="externalLink">GitHub project </a>
						</li>
						<li>
							<a href="github-report.html" title="Release notes">Release notes </a>
						</li>
						<li class="nav-header">Download</li>
						<li>
							<a href="downloads.html" title="Download">Download </a>
						</li>
						<li>
							<a href="license.html" title="License">License </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Contribute</li>
						<li>
							<a href="contribution.html" title="Contribute">Contribute </a>
						</li>
						<li>
							<a href="source-repository.html" title="Sources">Sources </a>
						</li>
						<li>
							<a href="http://github.com/ow2-chameleon/core/issues/" title="Issues" class="externalLink">Issues </a>
						</li>
						<li>
							<a href="http://github.com/ow2-chameleon/core" title="Fork on GitHub" class="externalLink">Fork on GitHub </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li>
							<a href="chameleon-quickstart.html" title="Quickstart">Quickstart </a>
						</li>
						<li>
							<a href="chameleon-structure.html" title="Structure">Structure </a>
						</li>
						<li>
							<a href="chameleon-configuration.html" title="Configuration">Configuration </a>
						</li>
						<li>
							<a href="chameleon-directory-monitor.html" title="Deployment">Deployment </a>
						</li>
						<li>
							<a href="chameleon-vm-args.html" title="JVM Arguments">JVM Arguments </a>
						</li>
						<li class="active">
							<a href="#" title="Extend Deployment">Extend Deployment </a>
						</li>
						<li>
							<a href="chameleon-package.html" title="Package your Chameleon">Package your Chameleon </a>
						</li>
						<li>
							<a href="chameleon-service.html" title="Run as service">Run as service </a>
						</li>
						<li>
							<a href="apidocs/index.html" title="API">API </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote><span class="color-highlight">OW2 Chameleon</span> ~ core proposes a minimal OSGi distribution used to structure OSGi applications.</blockquote>
				</div>
			</div>
		</div>
	</footer>
		
	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2014 <a href="https://github.com/ow2-chameleon/core">OW2 Chameleon</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 1.0.4-SNAPSHOT. </span><span class="publishDate">Last Published: 2014-02-09. </span></p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->

	<!-- Fallback jQuery loading from Google CDN:
	     http://stackoverflow.com/questions/1014203/best-way-to-use-googles-hosted-jquery-but-fall-back-to-my-hosted-library-on-go -->
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script type="text/javascript">
		if (typeof jQuery == 'undefined')
		{
			document.write(unescape("%3Cscript src='./js/jquery-1.8.3.min.js' type='text/javascript'%3E%3C/script%3E"));
		}
	</script>
	
	<script src="./js/bootstrap.min.js"></script>
	<script src="./js/lightbox.js"></script>
	<script src="./js/jquery.smooth-scroll.min.js"></script>
	<!-- back button support for smooth scroll -->
	<script src="./js/jquery.ba-bbq.min.js"></script>
	<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>
	
	</body>
</html>
